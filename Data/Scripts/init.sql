CREATE DATABASE GitPushForce

USE GitPushForce

DROP TABLE IF EXISTS Loans;
DROP TABLE IF EXISTS LoanRequest;
DROP TABLE IF EXISTS GivenTips;
DROP TABLE IF EXISTS Messages;
DROP TABLE IF EXISTS Tips;
DROP TABLE IF EXISTS ActivityLog;
DROP TABLE IF EXISTS CreditScoreHistory;
DROP TABLE IF EXISTS Investments;
DROP TABLE IF EXISTS TransactionLogs;
DROP TABLE IF EXISTS BillSplitReports;
DROP TABLE IF EXISTS ChatReports;
DROP TABLE IF EXISTS Users;

	
CREATE TABLE Users(
	ID INT PRIMARY KEY IDENTITY(1, 1),
	CNP VARCHAR(16) UNIQUE,
	FirstName VARCHAR(255) NOT NULL,
	LastName VARCHAR(255) NOT NULL,
	Email VARCHAR(255) NOT NULL,
	PhoneNumber VARCHAR(255),
	HashedPassword VARCHAR(255),
	NoOffenses INT,
	RiskScore INT,
	ROI DECIMAL(6, 2),
	CreditScore INT,
	Birthday DATE,
	ZodiacSign VARCHAR(255),
	ZodiacAttribute VARCHAR(255),
	NoOfBillSharesPaid INT NOT NULL,
	Income INT NOT NULL,
	Balance DECIMAL(10, 2) 
)

CREATE TABLE ChatReports(
    ID INT PRIMARY KEY IDENTITY(1, 1),
    ReportedUserCNP VARCHAR(16) NOT NULL,
    CONSTRAINT FK_CHATREPORT_USER FOREIGN KEY (ReportedUserCNP) REFERENCES Users(CNP),
    ReportedMessage VARCHAR(255),
    Status VARCHAR(255)
)

CREATE TABLE BillSplitReports(
    ID INT PRIMARY KEY IDENTITY(1, 1),
    ReportedUserCNP VARCHAR(16) NOT NULL,
    CONSTRAINT FK_BILLSPLIT_USERREPORTED FOREIGN KEY (ReportedUserCNP) REFERENCES Users(CNP),
    ReporterUserCNP VARCHAR(16) NOT NULL,
    CONSTRAINT FK_BILLSPLIT_USERREPORTER FOREIGN KEY (ReporterUserCNP) REFERENCES Users(CNP),
    DateOfTransaction DATE NOT NULL,
    BillShare DECIMAL(6, 2) NOT NULL,
    GravityFactor DECIMAL(6, 2) NOT NULL
)

CREATE TABLE TransactionLogs(
    ID INT PRIMARY KEY IDENTITY(1, 1),
    SenderCNP VARCHAR(16) NOT NULL,
    CONSTRAINT FK_TRANSACTIONLOGS_SENDER FOREIGN KEY (SenderCNP) REFERENCES Users(CNP),
    ReceiverCNP VARCHAR(16) NOT NULL,
    CONSTRAINT FK_TRANSACTIONLOGS_RECEIVER FOREIGN KEY (ReceiverCNP) REFERENCES Users(CNP),
    TransactionDate DATE NOT NULL,
    Amount DECIMAL(10, 2) NOT NULL,
    TransactionType VARCHAR(255) NOT NULL, -- e.g., "Bill Split", "Investment", "Loan Payment"
    TransactionDescription VARCHAR(255) NOT NULL
);

CREATE TABLE Investments(
    ID INT PRIMARY KEY IDENTITY(1, 1),
    InvestorCNP VARCHAR(16) NOT NULL,
    CONSTRAINT FK_INVESTMENTS_USER FOREIGN KEY (InvestorCNP) REFERENCES Users(CNP),
    Details VARCHAR(255),
    AmountInvested DECIMAL(6, 2) NOT NULL,
    AmountReturned DECIMAL(6, 2),
    InvestmentDate DATE NOT NULL
)

CREATE TABLE CreditScoreHistory(
    ID INT PRIMARY KEY IDENTITY(1, 1),
    UserCNP VARCHAR(16) NOT NULL,
    CONSTRAINT FK_CREDITSCOREHISTORY_USERS FOREIGN KEY (UserCNP) REFERENCES Users(CNP),
    Date DATE NOT NULL,
    Score INT
)

CREATE TABLE ActivityLog(
	ID INT PRIMARY KEY IDENTITY(1, 1),
	Name VARCHAR(16) NOT NULL,
	UserCNP VARCHAR(16) NOT NULL,
    CONSTRAINT FK_Activity_USERS FOREIGN KEY (UserCNP) REFERENCES Users(CNP),
	LastModifiedAmount INT NOT NULL,
	Details VARCHAR(100)
)

CREATE TABLE Tips(
    ID INT PRIMARY KEY IDENTITY(1, 1),
    CreditScoreBracket VARCHAR(255),
    TipText VARCHAR(255) NOT NULL
)

CREATE TABLE Messages(
    ID INT PRIMARY KEY IDENTITY(1, 1),
    Type VARCHAR(16),
    Message VARCHAR(255)
)

CREATE TABLE GivenTips(
    ID INT PRIMARY KEY IDENTITY(1, 1),
    UserCNP VARCHAR(16) NOT NULL,
    CONSTRAINT FK_GIVENTIPS_USERS FOREIGN KEY (UserCNP) REFERENCES Users(CNP),
    TipID INT,
    CONSTRAINT FK_GIVENTIPS_TIPS FOREIGN KEY (TipID) REFERENCES Tips(ID),
    MessageID INT,
    CONSTRAINT FK_GIVENTIPS_MESSAGES FOREIGN KEY (MessageID) REFERENCES Messages(ID),
    Date DATE NOT NULL
)

CREATE TABLE LoanRequest(
    ID INT PRIMARY KEY IDENTITY(1, 1),
    UserCNP VARCHAR(16) NOT NULL,
    CONSTRAINT FK_LOANREQUEST_USERS FOREIGN KEY (UserCNP) REFERENCES Users(CNP),
    Amount DECIMAL(6, 2) NOT NULL,
    ApplicationDate DATE NOT NULL,
    RepaymentDate DATE NOT NULL,
    Status VARCHAR(255)
)

CREATE TABLE Loans(
    ID INT PRIMARY KEY IDENTITY(1, 1),
    LoanRequestID INT NOT NULL,
    CONSTRAINT FK_LOANS_LOANREQUEST FOREIGN KEY (LoanRequestID) REFERENCES LoanRequest(ID),    
    UserCNP VARCHAR(16) NOT NULL,
    CONSTRAINT FK_LOANS_USERS FOREIGN KEY (UserCNP) REFERENCES Users(CNP),
    Amount DECIMAL(6, 2) NOT NULL,
    ApplicationDate DATE NOT NULL,
    RepaymentDate DATE NOT NULL,
    InterestRate FLOAT NOT NULL,
    NoMonths INT NOT NULL,
    State VARCHAR(255) NOT NULL,
    MonthlyPaymentAmount FLOAT NOT NULL,
    MonthlyPaymentsCompleted INT NOT NULL,
    RepaidAmount FLOAT NOT NULL,
    Penalty FLOAT NOT NULL
)
